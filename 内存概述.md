# 内存初探

1. 内存作用：一个临时的仓库，负责中转、暂存CPU工作需要的指令和数据
2. 内存组成：存储单元、PCB电路板、数据接口（金手指）等
3. 内存粗分：
   1. ROM（Read-Only Memory，装机前写入，断电不丢失）
   2. RAM（Random-Access Memory，断电丢失）

![img](../pics/120319_1113_DifferentTy1.png)

# 内存封装

## 内存颗粒（内存芯片）

1. 芯片位宽：内存芯片在单个传输周期所能提供的数据量。芯片的位宽一般都较小，台式机SDRAM芯片位宽最高也就是16bit，常见的则是8bit / 4bit。为了满足P-Bank所需的位宽，就需要多颗芯片并联工作。
2. 内存颗粒：

## BANK

### 物理Bank（P-Bank）

1. P-Bank其实就是一组内存芯片的集合，这个集合的容量不限，但该集合的总位宽必须与CPU数据位宽相符。
2. 同时，内存模组可以支持多个P-Bank，一次选择一个P-Bank工作。P-Bank又可被称为 Row 或者 Rank。

```
2. 传统内存系统为了保证CPU的正常工作，必须一次传输完CPU在一个传输周期内所需要的数据。而CPU在一个传输周期能接受的数据容量就是CPU数据总线的位宽，单位是bit（位）。

3. 如果32位的CPU与内存进行数据交换时，一个时钟周期内必须是32bit，要是用普通8bit位宽的内存颗粒的话，就需要4片并联起来才能满足要求。

4. 当时控制内存与CPU之间数据交换的北桥芯片也因此将内存总线的数据位宽等同于CPU数据总线的位宽，而这个位宽就称之为物理层（Physical Bank，P-Bank）的位宽。所以，那时的内存必须要组织成P-Bank来与CPU打交道。
```

### 逻辑Bank（L-Bank）

1. RAM内部可以看作是一个存储阵列，因而能够做到随机访问。
2. 指定行、列后便可以找到所需的存储单元，这个存储阵列也就是逻辑Bank。
3. 一般会将全容量的L-Bank分割成多个L-Bank。这样，在进行寻址时就要先确定是哪个L-Bank，然后再在这个选定的L-Bank中选择相应的行与列进行寻址。
4. 对内存的访问，一次只能是一个L-Bank工作，而每次与北桥交换的数据就是L-Bank存储阵列中一个“存储单元”的容量。这个存储单元有时也会被称为Word（位的集合）。
5. 内存容量表示：
   1. M × W：存储单元总数 × 存储单元容量
   2. 每个逻辑BANK的单元格数 × 逻辑BANK数量 × 每个单元格的位数（芯片的位宽）：4,194,304-WORDS × 4BANKS × 8-BITS（128MBits）

## DIP封装

**dual in-line package，双列直插封装**。是一种集成电路的封装方式，集成电路的外形为长方形，在其两侧则有两排平行的金属引脚，称为排针。DIP封装的元件一般会简称为DIPn，其中n是引脚的个数，例如十四针的集成电路即称为DIP14。早期的SRAM芯片采用这种封装技术。

![img](../pics/220px-Three_IC_circuit_chips.JPG)

## SIMM

**单列直插式内存模块**（**single in-line memory module，SIMM**），是一种单边接触内存模组，只在印刷基板的一个侧面附近配有电极（两侧金手指都提供相同信号的内存结构）。该模组包括了一个或多个RAM芯片，板上有引脚可以和计算机主板相连。

![File:SIMM 30 68 72.png](../pics/SIMM_30_68_72.png)

## DIMM

**双列直插式内存模块**（**double in-line memory module，DIMM**），相比SIMM两边针脚相连在一起，DIMM两边针脚是独立的。它们各自独立传输信号，因此可以满足更多数据信号的传送需要。

![File:Swissbit 2GB PC2-5300U-555.jpg](../pics/800px-Swissbit_2GB_PC2-5300U-555.jpg)

# RAM发展

## SRAM：static RAM，静态随机存储器

1. 不易失性：数据被存入后不会消失，直到断电或写入新的数据
2. 结构复杂：基本存储单元是由4-6个*MOS*管组成（数字锁存器），电路结构复杂，集成度低，制造成本大，行、列地址线分开使用
3. 应用场景：一般用作高速缓存

### SRAM存储单元（1bit）

![3743799_1294662381kBtL](../pics/3743799_1294662381kBtL.jpg)

### SRAM结构

![3743799_1294662384M2MS](../pics/3743799_1294662384M2MS.jpg)

1. 该*SRAM*有*8*位行地址，译码后生成*256*根行地址线；列地址线为*7*位，译码后生成*128*根列地址线；
2. 对*SRAM*进行读操作时，*OE#*和*CS#*为低电平，*WE#*为高电平，*G1*输出低电平将输入控缓冲器关闭，*G2*输出高电平将输出缓冲器打开，通过行列地址线选中的存储单元数据经*I/O*和输出缓冲器，最后从*I/O[0:7]*输出；写操作时，*WE#*和*CS#*为低电平，*OE#*为高电平，*G1*输出高电平将输入缓冲器打开，*G2*输出低电平将输出缓冲器关闭，*I/O[0:7]*上的输出经输入缓冲器和内部*I/O*总线，最后写入行列地址选中的存储空间中。

## DRAM：Dynamic RAM，动态随机存储器

1. 易失性：在一定的时间内需要不停刷新才能保持电容中的电荷（存储的数据），导致存取延迟大
2. 结构简单：基本存储单元是由一个晶体管和一个电容组成，电路结构简单，集成度高，制造成本小，行、列地址线复用
3. 应用场景：一般用作主存

### DRAM存储单元（1bit）

![3743799_1294662390R36G](../pics/3743799_1294662390R36G.jpg)

### DRAM刷新

DRAM是靠其内部电容电位来记录其逻辑值的，由于存储单元的访问是随机的，有可能某些存储单元长期得不到访问而由于电容放电致使电位下降，其存储单元内的原信息将会慢慢消失，为此，必须采用定时刷新的方法，对全部基本单元电路作一次刷新，一般取2ms的刷新周期。通常有[集中刷新、分散刷新和异步刷新](https://www.cnblogs.com/whhh/p/15725029.html)。

1. 通过/RAS引脚激活每一行就可以达到全部刷新；
2. 通过DRAM控制器来控制刷新，这样可以防止刷新操作干扰有规律的读写操作；
3. 刷新的过程实质上是先将原存信息读出，再由刷新放大器形成原信息并重新写入的再生过程

## SDRAM：Synchronous DRAM，同步动态随机存储器

1. “同步”：是指其时钟频率与*CPU*前端总线的系统时钟频率相同，并且内部命令的发送与数据的传输都以此频率为基准；
2. “动态”：是指存储阵列需要不断的刷新来保证所存储数据不丢失；
3. “随机”：是指数据不是线性存储，而是自由指定地址进行数据的读写

### SDRAM引脚与封装

![高手进阶！终极内存技术指南 ](../pics/ceF3X2NVlXJ4g.gif)

![高手进阶！终极内存技术指南 ](../pics/ce2rDQ1I8qfg.gif)

![高手进阶！终极内存技术指南 ](../pics/cePWQx4BcDzDo.gif)

1. 片选信号：根据片选信号对集合中的芯片进行寻址操作，被选中的芯片将接收或读取数据；
2. L-Bank地址信号：对所有被选中的芯片进行统一的L-Bank的寻址。SDRAM中L-Bank的数量最高为4个；
3. 存储单元寻址：对被选中的芯片进行统一的行/列（存储单元）寻址；
4. I/O引脚：被选中的芯片进行数据传输，在位宽相同的数据通道上传输

### SDRAM内部结构与工作时序

![高手进阶！终极内存技术指南 ](../pics/ceu2JzXm9HZLQ.gif)

![高手进阶！终极内存技术指南 ](../pics/ce8SKVMhemNt.gif)

注：除自刷新命令外，所有命令都是默认CKE有效

#### 芯片初始化（设置模式寄存器）

1. 在SDRAM芯片内部还有一个逻辑控制单元，并且有一个模式寄存器（MR，Mode Register）为其提供控制参数；**开机时SDRAM都要先对这个控制逻辑核心进行初始化**，该阶段关键在于模式寄存器的设置，MRSet，该工作由北桥芯片在BIOS的控制下进行，寄存器的信息由地址线来提供；
2. 地址线提供不同的0/1信号来获得不同的参数。在设置到MR之后，就开始了进入正常的工作状态。
3. 设置参数包括：操作模式、CAS  latency（CL）、BT、BL

![高手进阶！终极内存技术指南 ](../pics/ceIDxawuR1Eo.gif)

![高手进阶！终极内存技术指南 ](../pics/cefvpuCvm4o3k.gif)

#### 行有效（激活行）

初始化完成后，要想对一个L-Bank中的阵列进行寻址，首先就要确定行（Row），使之处于活动状态（Active），然后再确定列。虽然之前要进行片选和L-Bank的定址，但它们与行有效可以同时进行。

![高手进阶！终极内存技术指南 ](../pics/cegsvHuX7EdM.gif)

从图中可以看出，在CS#、L-Bank定址的同时，RAS（Row Address Strobe，行地址选通脉冲）也处于有效状态。此时An地址线则发送具体的行地址。**如图中是A0-A11，共有12个地址线**，由于是二进制表示法，所以共有4096个行（2^12=4096），A0-A11的不同数值就确定了具体的行地址。

#### 列读写

1. 在行地址敲定后，接下来对列地址寻址：**在SDRAM中，行地址与列地址线是共用的，WE#统一控制读写状态**。虽然地址线与行寻址共用，但CAS（Column Address Strobe，列地址选通脉冲）信号则可以区分开行与列寻址的不同，配合A0-A9，A11（本例）来确定具体的列地址。

   ![高手进阶！终极内存技术指南 ](../pics/ceMfmh8NO7Mw.gif)

2. tRCD：RAS to CAS Delay（RAS至CAS延迟），在发送列读写命令时与行有效命令的一个间隔，该间隔为了照顾电子元件充分响应而制定的延迟（行选通周期）。tRCD是SDRAM的一个重要时序参数，可以由BIOS自定义。广义的tRCD以时钟周期（tCK，Clock Time）数为单位，比如tRCD=3，就代表延迟周期为三个时钟周期。

   ![高手进阶！终极内存技术指南 ](../pics/ceZ9dhqdk7SmU.gif)

3. 时钟频率、时钟周期、数据传输频率

   ![高手进阶！终极内存技术指南 ](../pics/ceI0NuOaghau2.gif)

##### 数据输出（读）

在选定列地址后，就已经确定了具体的存储单元

##### 数据输入（写）

## DDR SDRAM：Double Data Rate SDRAM，双倍速率SDRAM

在时钟信号的上升沿和下降沿都采样数据，在时钟频率不变的情况，*DDR SDRAM*的数据存取速度提高了一倍

### DDR - DDR3

![3743799_1294662386GpqG](../pics/3743799_1294662386GpqG.jpg)

# 工作原理

## 内存控制器

# 内存时序

# DDR4

# DDR5